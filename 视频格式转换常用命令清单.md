macOS 下使用 ffmpeg 进行视频格式转换的常用命令清单，涵盖不同场景（如压缩、格式兼容、设备适配等），兼顾画质与效率：

### **一、基础格式转换（保持原画质）**

将视频转换为其他格式，尽量保留原始画质和参数：

```bash
# MP4 转 MKV（适合多音轨/字幕保留）
ffmpeg -i input.mp4 -c:v copy -c:a copy output.mkv

# MKV 转 MP4（提升兼容性，如手机/浏览器播放）
ffmpeg -i input.mkv -c:v copy -c:a aac -strict experimental output.mp4
# 说明：若音频不是 AAC，需重新编码（MP4 对音频格式限制较严）

# 任意格式转 WebM（适合网页播放，开源格式）
ffmpeg -i input.mov -c:v libvpx-vp9 -c:a libopus output.webm
```

- `-c:v copy`：复制视频流（不重新编码，速度快）
- `-c:a copy`：复制音频流（仅当目标格式支持时可用）

### **二、视频压缩（减小文件体积）**

通过降低码率或分辨率压缩视频，适合存储或分享：

```bash
# 降低码率（画质适中，体积减小）
ffmpeg -i input.mp4 -c:v libx264 -b:v 1500k -c:a aac -b:a 128k output.mp4
# 说明：-b:v 1500k 是视频码率（原视频码率的 50%-70% 为宜）

# 降低分辨率（如 4K 转 1080P）
ffmpeg -i input.mp4 -c:v libx264 -s 1920x1080 -c:a copy output_1080p.mp4
# 说明：-s 1920x1080 指定分辨率（宽x高）

# 按比例缩小（如原尺寸的 50%）
ffmpeg -i input.mp4 -vf "scale=iw*0.5:ih*0.5" -c:a copy output_small.mp4
# 说明：-vf "scale=iw*0.5:ih*0.5" 按比例缩放（iw=原宽，ih=原高）
```

### **三、H.265/HEVC 编码（高效压缩）**

H.265 比 H.264 体积小 50% 左右，适合高清视频存储：

```bash
# 转换为 H.265 编码的 MP4（平衡画质与体积）
ffmpeg -i input.mp4 -c:v libx265 -crf 28 -c:a aac -b:a 128k output_h265.mp4
# 说明：-crf 28 是质量系数（0-51，数值越小画质越好，28 为推荐值）

# 快速转换（牺牲部分压缩效率，提升速度）
ffmpeg -i input.mov -c:v libx265 -crf 30 -preset fast output_h265.mp4
# 说明：-preset fast 加快转换速度（可选：ultrafast < fast < medium < slow，越慢压缩率越高）
```

### **四、适配设备（手机 / 平板 / 电视）**

针对特定设备优化格式和参数：

```bash
# 适配 iPhone/iPad（H.264 + AAC，兼容所有 iOS 设备）
ffmpeg -i input.mp4 -c:v libx264 -profile:v main -level 3.1 -c:a aac -b:a 160k -movflags +faststart output_ios.mp4
# 说明：-movflags +faststart 支持网页边下边播

# 适配安卓设备（更灵活的参数）
ffmpeg -i input.mkv -c:v libx264 -s 1280x720 -c:a aac -b:a 128k output_android.mp4

# 适配电视播放（高兼容性）
ffmpeg -i input.mp4 -c:v libx264 -profile:v high -level 4.1 -c:a ac3 -b:a 384k output_tv.mp4
```

### **五、提取视频帧 / 片段**

截取视频片段或提取图片帧：

```bash
# 截取视频片段（从第 30 秒开始，持续 10 秒）
ffmpeg -i input.mp4 -ss 00:00:30 -t 00:00:10 -c copy output_clip.mp4
# 说明：-ss 起始时间，-t 持续时间（若用 -to 00:00:40 表示截止到第 40 秒）

# 提取视频首帧作为封面
ffmpeg -i input.mp4 -vframes 1 -q:v 2 cover.jpg
# 说明：-vframes 1 提取1帧，-q:v 2 图片质量（0-31，数值越小质量越高）

# 按间隔提取帧（每 5 秒1张）
ffmpeg -i input.mp4 -vf "fps=1/5" frame_%03d.jpg
```

### **六、批量转换**

批量处理文件夹中所有视频：

```bash
# 批量将 MKV 转为 MP4
for file in *.mkv; do
  ffmpeg -i "$file" -c:v copy -c:a aac -b:a 128k "${file%.mkv}.mp4"
done

# 批量压缩所有 MP4 为 720P
for file in *.mp4; do
  ffmpeg -i "$file" -c:v libx264 -s 1280x720 -c:a copy "${file%.mp4}_720p.mp4"
done
```

- 执行前需进入目标文件夹（`cd 路径`）
- 文件名含空格时需用引号包裹（如 `"视频文件.mp4"`）

### 注意事项：

1. 若提示 `ffmpeg: command not found`，需先安装：`brew install ffmpeg`（需先安装 Homebrew）。
2. 转换时间取决于视频长度和参数（H.265 比 H.264 慢 2-3 倍）。
3. 测试命令时建议先用短视频尝试，确认效果后再处理长视频。